{"version":3,"sources":["../../../routes/v1/users.js"],"names":["express","require","router","Router","User","auth","get","isAuthenticated","req","res","limit","parseInt","page","paginate","err","users","status","send","message","error","put","body","email","firstName","lastName","password","require_model","passport","findOne","user","newUser","id","registrationDate","Date","now","save","_id","params","post","isCurrentUser","findOneAndUpdate","console","log","delete","findOneAndRemove","module","exports"],"mappings":"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","file":"users.js","sourcesContent":["var express     = require('express');\nvar router      = express.Router();\nvar User        = require('../../models/userModel');\nvar auth        = require('../../middleware/authentification');\n\nrouter.get('/', auth.isAuthenticated, function(req, res) {\n    var limit = parseInt(req.get('X-Pagination-Limit')) || 10;\n    var page = parseInt(req.get('X-Pagination-Pages')) || 1;\n\n    User.paginate({}, { page: page, limit: limit }, function (err, users) {\n        if (err) {\n            res.status(500).send(\n                {\n                    message: 'Oupps something goes wrong',\n                    error: err\n                }\n            );\n        }\n        res.send(users);\n    });\n});\n\nrouter.put('/', function(req, res) {\n    if (!req.body.email || !req.body.firstName || !req.body.lastName || !req.body.password) {\n        return res.status(400).send({\n            message: 'Missing parameter',\n            require_model: {\n                email: 'email',\n                firstName: 'firstname',\n                lastName: 'lastname',\n                passport: 'password'\n            }\n        });\n    } else {\n        User.findOne({'email': req.body.email }, function (err, user) {\n            if (err) {\n                res.status(500).send(\n                    {\n                        message: 'Oupps something goes wrong',\n                        error: err\n                    }\n                );\n            }\n            if (user) {\n                return res.status(409).send({\n                    message: 'This email is already used.'\n                });\n            } else {\n                var newUser = new User({\n                    id: req.body.id,\n                    password: req.body.password,\n                    email: req.body.email,\n                    firstName: req.body.firstName,\n                    lastName: req.body.lastName,\n                    registrationDate: Date.now()\n                });\n                newUser.save(function (err) {\n                    if (err) {\n                        return res.status(403).send({\n                            message: 'Can\\'t create user',\n                            error: err\n                        });\n                    }\n                    return res.status(201).send({\n                        message: 'Created'\n                    });\n                });\n            }\n        })\n    }\n});\n\nrouter.get('/:id', auth.isAuthenticated,  function (req, res) {\n    User.findOne({_id: req.params.id}, function (err, user) {\n        if (err) {\n            res.status(500).send(\n                {\n                    message: 'Oupps something goes wrong',\n                    error: err\n                }\n            );\n        } else {\n            if (user) {\n                res.send(user);\n            } else {\n                res.status(404).send(\n                    {\n                        message: 'No user found'\n                    }\n                );\n            }\n        }\n    });\n});\n\nrouter.post('/:id', auth.isAuthenticated, auth.isCurrentUser, function (req, res) {\n    if (!req.params.id) {\n        return res.status(400).send({\n            message: 'Missing parameter'\n        });\n    }\n    User.findOne({_id: req.params.id}, function (err, user) {\n        if (!user) {\n            return res.status(403).send({\n                message: 'User ' + req.params.id + ' does not exist.'\n            });\n        }\n        user.firstName = req.body.firstName;\n        user.lastName = req.body.lastName;\n        User.findOneAndUpdate({_id: user._id}, user, function (err) {\n            if (err) {\n                console.log(err);\n            } else {\n                res.send({\n                    message: 'User updated'\n                });\n            }\n        });\n    });\n});\n\nrouter.delete('/:id', auth.isAuthenticated, auth.isCurrentUser, function (req, res) {\n    User.findOneAndRemove({_id: req.params.id}, function (err, user) {\n        if (err) {\n            res.status(500).send(\n                {\n                    message: 'Oupps something goes wrong',\n                    error: err\n                }\n            );\n        } else {\n            if (user) {\n                res.send(\n                    {\n                        message: 'User deleted'\n                    }\n                );\n            } else {\n                res.status(404).send(\n                    {\n                        message: 'No user found'\n                    }\n                );\n            }\n        }\n    });\n});\n\nmodule.exports = router;\n"]}